<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
    <title>Converting a IPYNB file to a page on this site</title>
    <style>
        code {
            white-space: pre-wrap;
        }

        span.smallcaps {
            font-variant: small-caps;
        }

        span.underline {
            text-decoration: underline;
        }

        div.column {
            display: inline-block;
            vertical-align: top;
            width: 50%;
        }

        div.hanging-indent {
            margin-left: 1.5em;
            text-indent: -1.5em;
        }

        ul.task-list {
            list-style: none;
        }

        .center {
            margin: 0;
            top: 50%;
            left: 50%;
            right: 50%;
            bottom: 50%;
        }

        .button {
            background-color: #282828;
            border: 1px solid #ebdbb2;
            color: #ebdbb2;
        }

        /* color scheme source: https://github.com/daveyarwood/gruvbox-pygments/blob/master/gruvbox.css */
        .highlight .hll {
            background-color: #ffffcc
        }

        .highlight {
            background: #282828;
            color: #ebdbb2;
            background-color: #282828
        }

        .highlight .c {
            color: #928374;
            font-style: italic;
            background-color: #282828
        }

        /* Comment */
        .highlight .err {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Error */
        .highlight .esc {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Escape */
        .highlight .g {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Generic */
        .highlight .k {
            color: #fe8019;
            background-color: #282828
        }

        /* Keyword */
        .highlight .l {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Literal */
        .highlight .n {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Name */
        .highlight .o {
            color: #fe8019;
            background-color: #282828
        }

        /* Operator */
        .highlight .x {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Other */
        .highlight .p {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Punctuation */
        .highlight .ch {
            color: #928374;
            font-style: italic;
            background-color: #282828
        }

        /* Comment.Hashbang */
        .highlight .cm {
            color: #928374;
            font-style: italic;
            background-color: #282828
        }

        /* Comment.Multiline */
        .highlight .cp {
            color: #8ec07c;
            background-color: #282828
        }

        /* Comment.Preproc */
        .highlight .c1 {
            color: #928374;
            font-style: italic;
            background-color: #282828
        }

        /* Comment.Single */
        .highlight .cs {
            color: #928374;
            font-style: italic;
            background-color: #282828
        }

        /* Comment.Special */
        .highlight .gd {
            color: #282828;
            background-color: #fb4934
        }

        /* Generic.Deleted */
        .highlight .ge {
            color: #83a598;
            text-decoration: underline;
            background-color: #282828
        }

        /* Generic.Emph */
        .highlight .gr {
            color: #ebdbb2;
            font-weight: bold;
            background-color: #fb4934
        }

        /* Generic.Error */
        .highlight .gh {
            color: #b8bb26;
            font-weight: bold;
            background-color: #282828
        }

        /* Generic.Heading */
        .highlight .gi {
            color: #282828;
            background-color: #b8bb26
        }

        /* Generic.Inserted */
        .highlight .go {
            color: #504945;
            background-color: #282828
        }

        /* Generic.Output */
        .highlight .gp {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Generic.Prompt */
        .highlight .gs {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Generic.Strong */
        .highlight .gu {
            color: #b8bb26;
            font-weight: bold;
            background-color: #282828
        }

        /* Generic.Subheading */
        .highlight .gt {
            color: #ebdbb2;
            font-weight: bold;
            background-color: #fb4934
        }

        /* Generic.Traceback */
        .highlight .kc {
            color: #fe8019;
            background-color: #282828
        }

        /* Keyword.Constant */
        .highlight .kd {
            color: #fe8019;
            background-color: #282828
        }

        /* Keyword.Declaration */
        .highlight .kn {
            color: #fe8019;
            background-color: #282828
        }

        /* Keyword.Namespace */
        .highlight .kp {
            color: #fe8019;
            background-color: #282828
        }

        /* Keyword.Pseudo */
        .highlight .kr {
            color: #fe8019;
            background-color: #282828
        }

        /* Keyword.Reserved */
        .highlight .kt {
            color: #fabd2f;
            background-color: #282828
        }

        /* Keyword.Type */
        .highlight .ld {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Literal.Date */
        .highlight .m {
            color: #d3869b;
            background-color: #282828
        }

        /* Literal.Number */
        .highlight .s {
            color: #b8bb26;
            background-color: #282828
        }

        /* Literal.String */
        .highlight .na {
            color: #b8bb26;
            font-weight: bold;
            background-color: #282828
        }

        /* Name.Attribute */
        .highlight .nb {
            color: #fabd2f;
            background-color: #282828
        }

        /* Name.Builtin */
        .highlight .nc {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Name.Class */
        .highlight .no {
            color: #d3869b;
            background-color: #282828
        }

        /* Name.Constant */
        .highlight .nd {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Name.Decorator */
        .highlight .ni {
            color: #fabd2f;
            background-color: #282828
        }

        /* Name.Entity */
        .highlight .ne {
            color: #fb4934;
            background-color: #282828
        }

        /* Name.Exception */
        .highlight .nf {
            color: #fabd2f;
            background-color: #282828
        }

        /* Name.Function */
        .highlight .nl {
            color: #fb4934;
            background-color: #282828
        }

        /* Name.Label */
        .highlight .nn {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Name.Namespace */
        .highlight .nx {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Name.Other */
        .highlight .py {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Name.Property */
        .highlight .nt {
            color: #fb4934;
            background-color: #282828
        }

        /* Name.Tag */
        .highlight .nv {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Name.Variable */
        .highlight .ow {
            color: #fe8019;
            background-color: #282828
        }

        /* Operator.Word */
        .highlight .w {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Text.Whitespace */
        .highlight .mb {
            color: #d3869b;
            background-color: #282828
        }

        /* Literal.Number.Bin */
        .highlight .mf {
            color: #d3869b;
            background-color: #282828
        }

        /* Literal.Number.Float */
        .highlight .mh {
            color: #d3869b;
            background-color: #282828
        }

        /* Literal.Number.Hex */
        .highlight .mi {
            color: #d3869b;
            background-color: #282828
        }

        /* Literal.Number.Integer */
        .highlight .mo {
            color: #d3869b;
            background-color: #282828
        }

        /* Literal.Number.Oct */
        .highlight .sb {
            color: #b8bb26;
            background-color: #282828
        }

        /* Literal.String.Backtick */
        .highlight .sc {
            color: #b8bb26;
            background-color: #282828
        }

        /* Literal.String.Char */
        .highlight .sd {
            color: #b8bb26;
            background-color: #282828
        }

        /* Literal.String.Doc */
        .highlight .s2 {
            color: #b8bb26;
            background-color: #282828
        }

        /* Literal.String.Double */
        .highlight .se {
            color: #b8bb26;
            background-color: #282828
        }

        /* Literal.String.Escape */
        .highlight .sh {
            color: #b8bb26;
            background-color: #282828
        }

        /* Literal.String.Heredoc */
        .highlight .si {
            color: #b8bb26;
            background-color: #282828
        }

        /* Literal.String.Interpol */
        .highlight .sx {
            color: #b8bb26;
            background-color: #282828
        }

        /* Literal.String.Other */
        .highlight .sr {
            color: #b8bb26;
            background-color: #282828
        }

        /* Literal.String.Regex */
        .highlight .s1 {
            color: #b8bb26;
            background-color: #282828
        }

        /* Literal.String.Single */
        .highlight .ss {
            color: #83a598;
            background-color: #282828
        }

        /* Literal.String.Symbol */
        .highlight .bp {
            color: #fabd2f;
            background-color: #282828
        }

        /* Name.Builtin.Pseudo */
        .highlight .vc {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Name.Variable.Class */
        .highlight .vg {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Name.Variable.Global */
        .highlight .vi {
            color: #ebdbb2;
            background-color: #282828
        }

        /* Name.Variable.Instance */
        .highlight .il {
            color: #d3869b;
            background-color: #282828
        }

        /* Literal.Number.Integer.Long */
        img {
            background-color: white;
        }
    </style>
    <link rel="stylesheet" href="https://benrosenberg.info/style.css" />
    <link rel="icon" type="image/png" href="https://benrosenberg.info/favicon.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js"></script>
    <script>document.addEventListener("DOMContentLoaded", function () {
            var mathElements = document.getElementsByClassName("math");
            var macros = [];
            for (var i = 0; i < mathElements.length; i++) {
                var texText = mathElements[i].firstChild;
                if (mathElements[i].tagName == "SPAN") {
                    katex.render(texText.data, mathElements[i], {
                        displayMode: mathElements[i].classList.contains('display'),
                        throwOnError: false,
                        macros: macros,
                        fleqn: false
                    });
                }
            }
        });
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" />
</head>

<body>
    <ul class="sidenav">
        <li><a href="/">Home</a></li>
        <li><a class="active" href="https://benrosenberg.info/posts">Posts</a></li>
        <li><a href="https://github.com/benrosenberg">GitHub</a></li>
        <li><a href="https://benrosenberg.info/teaching/">Teaching</a></li>
    </ul>

    <div class="content">

        <div class="wrapped-ipynb">
            <div class="wrapped-markdown">
                <h1>SSH login attempt analysis</h1>
                <p>2024-06-16</p>
                <p>I left the SSH port on my DigitalOcean droplet open for a while (since September 16 2023, so exactly
                    9 months now). Time to take a look at who tried to log in!</p>
                <p>Disclaimer: I suck at shell scripting, and there is a lot of shell scripting/oneliner creation in
                    here that could definitely be optimized more.</p>
            </div>
            <div class="wrapped-markdown">
                <h2>Usernames</h2>
                <p>First, I wanted to see what usernames were attempted. I have two users on my droplet -
                    <code>root</code> and a personal user account. The personal username did not get used in any of the
                    attempts made by third parties, but <code>root</code> got a ton of attempts. In fact, the number of
                    attempts to log in to <code>root</code> dwarfs all the other attempts combined:</p>
                <p><code>bash
$ sudo grep "Failed password for root" /var/log/auth.log | wc -l
20383
$sudo grep "Failed password for invalid user" /var/log/auth.log | wc -l
5019</code></p>
                <p>The file <code>/var/log/auth.log</code> keeps logs of all login attempts (whether they succeeded or
                    failed). Here, we're looking for the patterns <code>"Failed password for root"</code> and
                    <code>"Failed password for invalid user"</code> with the command <code>grep</code>, and passing the
                    lines that contain that pattern to <code>wc -l</code>, which counts (<code>c</code>) the number of
                    lines (<code>-l</code>) passed to it.</p>
                <p>We'll get back to the root attempts later.</p>
                <p>Here is a pie chart of the non-root users:</p>
                <p><img alt="Username pie chart (matplotlib)" src="username_pie_chart.png" /></p>
                <p>I made this pie chart in Python with <code>matplotlib</code> and the following code:</p>
            </div>
            <div class="wrapped-code">
                <div class="highlight">
                    <pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;ssh_username_attempts.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">usernames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">both</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">count</span><span class="p">,</span> <span class="n">username</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">both</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">count</span><span class="p">),</span> <span class="n">username</span><span class="p">))</span>
    <span class="n">both</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">both</span><span class="p">:</span>
        <span class="n">usernames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
        <span class="n">counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">15</span>

<span class="n">username_subset</span> <span class="o">=</span> <span class="n">usernames</span><span class="p">[:</span><span class="n">N</span><span class="p">]</span>
<span class="n">count_subset</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[:</span><span class="n">N</span><span class="p">]</span>
<span class="n">other_counts</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">N</span><span class="p">:])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">username_subset</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">count_subset</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">counts</span><span class="p">),</span><span class="mi">10</span><span class="p">))</span>
<span class="n">patches</span><span class="p">,</span> <span class="n">texts</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">count_subset</span> <span class="o">+</span> <span class="p">[</span><span class="n">other_counts</span><span class="p">],</span>  <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">patches</span><span class="p">,</span> <span class="n">username_subset</span><span class="o">+</span><span class="p">[</span><span class="s1">&#39;Other&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre>
                </div>

            </div>
            <div class="wrapped-markdown">
                <p>But this was rather cumbersome, and not very portable; rather than writing a script, I wanted to have
                    a cli oneliner to whip out whenever I needed to see this for any server. I decided to use gnuplot
                    instead. Here is that plot:</p>
                <p><img alt="Username bar chart (gnuplot)" src="username_bar_chart.png" /></p>
                <p>Here's the oneliner for it: </p>
                <p><code>bash
$ sudo awk '/Failed password for invalid user/ { print $(NF-5)}' /var/log/auth.log | sort | uniq -c | sort -k1nr | head -25 | gnuplot -p -e "set xtics rotate by 45 right; plot '&lt;cat' using 1: xtic(2) title 'attempts' with histogram"</code>
                </p>
                <p>Or if that's too much, you can put the counts and values into a temp file first, and then put that
                    into gnuplot:</p>
                <p><code>bash
$ sudo awk '/Failed password for invalid user/ { print $(NF-5)}' /var/log/auth.log | sort | uniq -c &gt; tmp.txt
$ cat tmp.txt | sort -k1nr | head -25 | gnuplot -p -e "set xtics rotate by 45 right; plot '&lt;cat' using 1: xtic(2) title 'attempts' with histogram"</code>
                </p>
                <p>How does this oneliner work?</p>
                <h3><code>sudo awk '/Failed password for invalid user/ { print $(NF-5)}' /var/log/auth.log</code></h3>
                <p>This command calls <code>awk</code>, a text editing program, with the argument
                    <code>'/Failed password for invalid user/ { print $(NF-5)}'</code> on our file
                    <code>/var/log/auth.log</code>. In <code>awk</code>, the variable <code>NF</code> refers to the last
                    field of the line, so <code>$(NF-5)</code> refers to the field 5 before the last one. For example:
                </p>
                <p><code>bash
$ echo "1 2 3 4 5 6 7 8" | awk '{print $(NF-5)}'
3</code></p>
                <h3><code>sort | uniq -c</code></h3>
                <p>This command sorts the data and then removes repeated lines, and counts the number of repeated lines.
                    If we just called <code>uniq</code>, it wouldn't be enough because there could be duplicate lines
                    that are non-adjacent. Calling <code>sort</code> first ensures that all duplicate lines are grouped
                    together. A couple examples:</p>
                <p><code>bash
$ echo "1
2
2
2
3
2
1" | uniq
1
2
3
2
1
$ echo "1
2
2
2
3
2
1" | sort | uniq
1
2
3
$ echo "1
2
2
2
3
2
1" | sort | uniq -c
      2 1
      4 2
      1 3
</code></p>
                <h3><code>sort -k1nr | head -25</code></h3>
                <p>This command sorts the first field (<code>k1</code>, or key 1) numerically (<code>n</code>, so that
                    <code>11</code> comes before <code>100</code> and not after it) in reversed (descending) order
                    (<code>r</code>). </p>
                <p><code>head -25</code> takes the first 25 lines of what is passed in.</p>
                <h3><code>gnuplot -p -e "set xtics rotate by 45 right; plot '&lt;cat' using 1: xtic(2) title 'attempts' with histogram"</code>
                </h3>
                <p>This long gnuplot command can be broken into the following:</p>
                <ul>
                    <li><code>-p</code>: persist the plot window even after the main gnuplot program exits</li>
                    <li><code>-e</code>: execute the given string as a command</li>
                    <li><code>"set xtics rotate by 45 right; plot '&lt;cat' using 1: xtic(2) title 'attempts' with histogram"</code>:
                        a command, which does the following:</li>
                    <li><code>set xtics rotate by 45 right</code>: rotate the x-ticks 45 degrees from the right side, so
                        that they don't overlap each other (which would happen if they were all side-by-side
                        horizontally)</li>
                    <li><code>plot '&lt;cat'</code>: plot using standard input (the input passed/piped in by our
                        previous commands)</li>
                    <li><code>using 1: xtic(2)</code>: plot the first field on the y-axis and use the second field as
                        the x-ticks</li>
                    <li><code>title 'attempts'</code>: set the data label to <code>attempts</code>, rather than the
                        default (which would be the entire <code>plot '&lt;cat' ...</code> command)</li>
                    <li><code>with histogram</code>: create a 2d bar chart with parallel columns (not necessarily
                        restricted to histograms)</li>
                </ul>
            </div>
            <div class="wrapped-markdown">
                <h2>IP addresses and countries</h2>
                <p>Now let's look at the IP addresses (and countries) of our would-be attackers. To make things simple,
                    let's just focus on the attempts to log in as <code>root</code>.</p>
                <p>Here's a plot of the top 25 IP addresses by number of attempts:</p>
                <p><img alt="Top 25 IP addresses" src="top_25_ips.png" /></p>
                <p>The top one has tried to log in nearly 18,000 times! Let's get rid of it and look at the rest:</p>
                <p><img alt="Top 25 IP addresses (excluding the first one)" src="top_25_ips_excluding_first.png" /></p>
                <p>Didn't save the code for these plots, but should be easy to figure out what it was from context.</p>
                <p>Here's the more important part: the countries associated with each IP address:</p>
                <p><img alt="Top 25 countries" src="top_25_countries.png" /></p>
                <p>Looks like we know where the top IP is based - the United States. This guy is apparently a known
                    attacker and appears on several blocklists. Maybe I should block him too?</p>
                <p>Here are the top 25 countries minus the United States:</p>
                <p><img alt="Top 25 countries (excluding the US)" src="top_25_countries_excluding_first.png" /></p>
                <p>Lots of login attempts from China, which is expected.</p>
                <p>Here is the code for generating the country plots, first as a oneliner and then as a series of
                    commands.</p>
                <p>Oneliner:</p>
                <p><code>bash
$ sudo awk '/Failed password for root/ { print $(NF-3) }' /var/log/auth.log | sort | xargs -L 1 geoiplookup | cut -d " " -f 1-4 --complement | sort | uniq -c | sort -k1nr | head -25 | awk '{$1=$1};1' | awk '{sub(" ","|")}1' | awk '{split($0,a,"|"); print a[1] " \"" a[2] "\""}' | gnuplot -p -e "set xtics rotate by 45 right; plot '&lt;cat' using 1: xtic(2) title 'attempts' with histogram"</code>
                </p>
                <p>Series of commands:</p>
                <p><code>bash
$ sudo awk '/Failed password for root/ { print $(NF-3) }' /var/log/auth.log | sort &gt; ssh_ip_attempts_all.txt
$ cat ssh_ip_attempts_all.txt | xargs -L 1 geoiplookup | cut -d " " -f 1-4 --complement | sort | uniq -c | sort -k1nr | head -25 &gt; top_25_countries.txt
$ cat top_25_countries.txt | awk '{$1=$1};1' | awk '{sub(" ","|")}1' | awk '{split($0,a,"|"); print a[1] " \"" a[2] "\""}' | gnuplot -p -e "set xtics rotate by 45 right; plot '&lt;cat' using 1: xtic(2) title 'attempts' with histogram"</code>
                </p>
                <p>This command takes a bit longer because it's doing a bunch of database lookups with the
                    <code>geoiplookup</code> command (from the <code>geoip-bin</code> Debian package in my case). The
                    package comes with a database (possibly outdated?) that maps IP addresses to countries, which is
                    nice. There are more granular databases that you can download from MaxMind or from GitHub that have
                    data at the city or ASN levels, but for my purposes country was fine.</p>
                <p>Let's unpack this command too, this time using the series of commands as a reference:</p>
                <h3><code>sudo awk '/Failed password for root/ { print $(NF-3) }' /var/log/auth.log | sort &gt; ssh_ip_attempts_all.txt</code>
                </h3>
                <p>Nothing new here. Just using <code>awk</code> to get the 4th-from-last field (which happens to be the
                    IP address) in the <code>root</code> login failures stored in <code>/var/log/auth.log</code>. We
                    then sort these by IP and stick them in the file <code>ssh_ip_attempts_all.txt</code>.</p>
                <h3><code>cat ssh_ip_attempts_all.txt | xargs -L 1 geoiplookup | cut -d " " -f 1-4 --complement | sort | uniq -c | sort -k1nr | head -25 &gt; top_25_countries.txt</code>
                </h3>
                <p>The complicated parts are contained here:
                    <code>xargs -L 1 geoiplookup | cut -d " " -f 1-4 --complement</code></p>
                <ul>
                    <li><code>xargs -L 1 geoiplookup</code>: uses <code>xargs</code> to pipe the IP addresses into the
                        <code>geoiplookup</code> command. The <code>-L 1</code> prevents multiple lines from being piped
                        into one call to <code>geoiplookup</code>; basically, just ensures that each IP address gets its
                        own country lookup.</li>
                    <li><code>cut -d " " -f 1-4 --complement</code>: this command cuts the lines by the delimiter
                        (<code>-d</code>) of a single space, and then takes what is NOT (<code>--complement</code>) in
                        the first four fields (<code>-f 1-4</code>). Since the <code>geoiplookup</code> command
                        typically spits out something that looks like this (using Netherlands as an example country):
                        <code>GeoIP Country Edition: NL, Netherlands</code>, we want to get rid of the first 4 fields to
                        leave just <code>Netherlands</code>.</li>
                </ul>
                <p>The rest of the commands should make sense by now.</p>
                <h3><code>cat top_25_countries.txt | awk '{$1=$1};1' | awk '{sub(" ","|")}1' | awk '{split($0,a,"|"); print a[1] " \"" a[2] "\""}' | gnuplot -p -e "set xtics rotate by 45 right; plot '&lt;cat' using 1: xtic(2) title 'attempts' with histogram"</code>
                </h3>
                <p>The meat of this command is the series of <code>awk</code> commands. (I'm sure there's a better way
                    to do this, but what I have works.)</p>
                <ul>
                    <li><code>awk '{$1=$1};1'</code>: trims spaces around each line, and turns each group of spaces/tabs
                        into a single space. Basically the equivalent of <code>' '.join(s.strip().split())</code> in
                        Python. This happens because <code>$1=$</code> forces the record in <code>awk</code> to be
                        "reconstituted" (read more here: <a
                            href="https://www.gnu.org/software/gawk/manual/html_node/Changing-Fields.html">https://www.gnu.org/software/gawk/manual/html_node/Changing-Fields.html</a>).
                        The <code>1</code> at the end of the command is an <code>awk</code> trick to print the current
                        record.</li>
                    <li><code>awk '{sub(" ","|")}1'</code>: substitute the first space in the record with a pipe or "|".
                        This will be used later so we can ensure that we split on only the first space, and not future
                        spaces.</li>
                    <li><code>awk '{split($0,a,"|"); print a[1] " \"" a[2] "\""}'</code>: split on the pipe we added
                        above, and then print the first field (which is the number of entries we have for that country),
                        and follow it with a space and then the second field (the country name) enclosed in double
                        quotes. We need to enclose the country name in double quotes so that gnuplot groups the entire
                        country name together - in "United States" for example, if we didn't enclose the country name in
                        double quotes, gnuplot would just display <code>United</code> as the x-tick label.</li>
                </ul>
                <p>The gnuplot command is the same as before.</p>
            </div>
            <div class="wrapped-markdown">
                <h2>Conclusion</h2>
                <p>This was a fun project. I'll probably take a look at the stats again next year, but will likely just
                    blindly copy and paste the oneliner I used above to see the charts rather than thinking about what's
                    actually going on (unless something breaks!).</p>
            </div>
        </div>

    </div>

</body>

</html>