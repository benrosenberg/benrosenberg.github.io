<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OTP Bookmarklet Generator</title>

    <style>
        :root {
            --bg-color: #282828;
            --text-color: #ebdbb2;
            --main-font: 'Inter', sans-serif;
            --ui-dark-bg: #3c3836;
            --ui-input-bg: #504945;
            --ui-primary-accent: #fe8019;
            --ui-secondary-accent: #83a598;
            --ui-error-color: #fb4934;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');

        body {
            margin: 0;
            padding: 1rem;
            /* p-4 */
            font-family: var(--main-font);
            text-align: left;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        @media (min-width: 768px) {
            body {
                padding: 2rem;
                /* md:p-8 */
            }
        }

        .main-container {
            max-width: 56rem;
            /* max-w-xl */
            margin-left: auto;
            margin-right: auto;
            padding: 1.5rem;
            /* p-6 */
            border-radius: 0.5rem;
            /* rounded-lg */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            /* shadow-xl */
            background-color: var(--ui-dark-bg);
            width: 100%;
        }

        @media (min-width: 768px) {
            .main-container {
                padding: 2rem;
                /* md:p-8 */
            }
        }

        h1 {
            font-size: 1.875rem;
            /* text-3xl */
            font-weight: 700;
            /* font-bold */
            margin-bottom: 1rem;
            /* mb-4 */
            color: var(--text-color);
            border-bottom: 1px solid #4b5563;
            /* border-gray-600 */
            padding-bottom: 0.5rem;
            /* pb-2 */
        }

        h2 {
            font-size: 1.25rem;
            /* text-xl */
            font-weight: 600;
            /* font-semibold */
            margin-bottom: 0.75rem;
            /* mb-3 */
            color: var(--text-color);
        }

        .description {
            margin-bottom: 1.5rem;
            /* mb-6 */
            color: var(--text-color);
            font-size: 0.875rem;
            /* text-sm */
            opacity: 0.9;
        }

        .input-group {
            margin-bottom: 1rem;
            /* mb-4 */
        }

        label {
            display: block;
            font-size: 0.875rem;
            /* text-sm */
            font-weight: 500;
            /* font-medium */
            color: var(--text-color);
            margin-bottom: 0.5rem;
            /* mb-2 */
            opacity: 0.9;
        }

        .input-field {
            width: 100%;
            padding: 0.5rem 1rem;
            /* px-4 py-2 */
            border-radius: 0.375rem;
            /* rounded-md */
            letter-spacing: 0.05em;
            /* tracking-wider */
            font-family: monospace;
            /* font-mono */
            font-size: 1rem;
            /* text-base */
            transition: all 150ms ease-in-out;
            background-color: var(--ui-input-bg);
            border: 1px solid #665c54;
            color: var(--text-color);
            outline: none;
        }

        .input-field:focus {
            box-shadow: 0 0 0 4px rgba(254, 128, 25, 0.5);
        }

        .help-text {
            font-size: 0.75rem;
            /* text-xs */
            color: var(--text-color);
            margin-top: 0.25rem;
            /* mt-1 */
            opacity: 0.7;
        }

        .main-button {
            width: 100%;
            font-weight: 600;
            /* font-semibold */
            padding: 0.75rem 1.5rem;
            /* py-3 px-6 */
            border-radius: 0.375rem;
            /* rounded-md */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            /* shadow-md */
            transition: all 150ms ease-in-out;
            outline: none;
            border: none;
            cursor: pointer;
        }

        .section-divider {
            margin-top: 2rem;
            /* mt-8 */
            padding-top: 1.5rem;
            /* pt-6 */
            border-top: 1px solid #4b5563;
            /* border-gray-600 */
        }

        .code-output {
            display: block;
            padding: 1rem;
            /* p-4 */
            border-radius: 0.375rem;
            /* rounded-md */
            font-size: 0.75rem;
            /* text-xs */
            word-break: break-all;
            font-family: monospace;
            user-select: all;
            background-color: var(--ui-input-bg);
            border: 1px solid #665c54;
            color: var(--ui-error-color);
        }

        .copy-button {
            margin-top: 0.75rem;
            /* mt-3 */
            color: var(--ui-dark-bg);
            /* Adjusted color for better contrast with accent */
            font-weight: 600;
            /* font-semibold */
            padding: 0.5rem 1rem;
            /* py-2 px-4 */
            border-radius: 0.375rem;
            /* rounded-md */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            transition: all 150ms ease-in-out;
            outline: none;
            border: none;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .copy-button svg {
            height: 1.25rem;
            width: 1.25rem;
            margin-right: 0.5rem;
        }
    </style>
</head>

<!-- Generated with help from Google Gemini: 2025-10-19 -->

<body class="p-4">

    <div class="main-container">
        <h1>OTP Code Bookmarklet Generator</h1>
        <p
            style="background-color: #ffcccc; color: #cc0000; border: 3px solid #990000; padding: 20px; text-align: center; font-family: 'Arial', sans-serif; font-size: 1.5em; font-weight: bold; border-radius: 8px; box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);">
            <span style="font-size: 2em; display: block; margin-bottom: 10px;">&#9888; DANGER &#9888;</span>
            <span style="display: block; font-size: 1.2em; line-height: 1.3;">I TAKE NO RESPONSIBILITY IF YOU GET
                HACKED.</span>
            <span style="display: block; font-size: 0.9em; margin-top: 10px;">Proceed at your own risk.</span>
            <span style="display: block; font-size: 0.9em; margin-top: 10px;">Your secret key will be stored in
                plaintext, not only temporarily in the text area on this page, but permanently in the bookmarklet as
                long as you don't delete it.</span>
            <span style="display: block; font-size: 0.9em; margin-top: 10px;">This site is a static webpage, so it
                doesn't have access to your secrets, but pasting your MFA secrets here could leave you vulnerable to
                other avenues of attack like XSS (cross-site scripting).</span>
            <span style="display: block; font-size: 0.9em; margin-top: 10px;">Additionally, bookmarks may be vulnerable
                to attacks by malicious browser extensions; even if you aren't compromised yet, you may be if some
                browser extension you have installed is compromised in the future.</span>
        </p>
        <p class="description">
            This tool generates a single-line, highly compressed JavaScript bookmarklet that calculates a TOTP code and
            attempts to copy it to the clipboard. If copying fails, the string "copying failed" is copied instead.
        </p>
        <p class="description">
            First, you will need to create a new OTP key for whatever service you are trying to use. If the service only
            offers a QR code as the OTP method, you will need to scan the QR code with a QR code reading app or some
            other method, and then copy the secret key into the below field. Once you've done that, the bookmarklet code
            should update to reflect your secret key hardcoded into the code.
        </p>
        <p class="description">
            Next, copy the bookmarklet code by using the "Copy Bookmarklet Code" button beneath it.
        </p>
        <p class="description">
            After copying the bookmarklet contents below, create a new bookmark by right-clicking the bookmark bar and
            selecting "Add page...". Set the name to whatever you want, paste the code into the URL field, and hit Save.
        </p>
        <p class="description">
            Then, whenever you need to log into whatever service requires OTP, you should be able to click the bookmark,
            which will copy the code directly to your clipboard, and paste the code into the OTP code field.
        </p>

        <div class="input-group">
            <label for="otpSecret">Base32 Secret Key</label>
            <input type="text" id="otpSecret" value="JBSWY3DPEHPK3PXP" class="input-field">
            <p class="help-text">The key is hardcoded directly into the final generated bookmarklet.</p>
        </div>

        <button id="runDemo" class="main-button"
            style="background-color: var(--ui-primary-accent); color: var(--ui-dark-bg);"
            onmouseover="this.style.backgroundColor='#d65d0e'"
            onmouseout="this.style.backgroundColor='var(--ui-primary-accent)'">
            Simulate Running Generated Bookmarklet
        </button>

        <div class="section-divider">
            <h2>Bookmarklet Code String</h2>
            <p class="description">Copy the entire string below to the URL field of a new browser bookmark.</p>
            <code id="bookmarkletOutput" class="code-output" style="color: var(--ui-error-color);">
                Bookmarklet code will appear here.
            </code>
            <button id="copyBookmarklet" class="copy-button"
                style="background-color: var(--ui-secondary-accent); color: var(--ui-dark-bg);"
                onmouseover="this.style.backgroundColor='#689d6a'"
                onmouseout="this.style.backgroundColor='var(--ui-secondary-accent)'">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" />
                    <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" />
                </svg>
                Copy Bookmarklet Code
            </button>
        </div>
    </div>

    <script>
        function base32Decode(base32) {
            const BASE32_CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
            let bits = 0;
            let buffer = 0;
            let result = [];
            base32 = base32.toUpperCase().replace(/=+$/, '').replace(/\s/g, '');

            for (let i = 0; i < base32.length; i++) {
                let char = base32.charAt(i);
                let val = BASE32_CHARS.indexOf(char);

                if (val < 0) continue;

                buffer = (buffer << 5) | val;
                bits += 5;

                while (bits >= 8) {
                    result.push((buffer >>> (bits - 8)) & 0xFF);
                    bits -= 8;
                }
            }
            return new Uint8Array(result).buffer;
        }

        async function generateTotp(secretKeyBase32) {
            const timeStep = 30;
            const digits = 6;
            const now = Date.now();
            const counter = Math.floor(now / 1000 / timeStep);
            const timeRemaining = timeStep - Math.floor((now / 1000) % timeStep);

            const keyBytes = base32Decode(secretKeyBase32);
            const counterBuffer = new ArrayBuffer(8);
            new DataView(counterBuffer).setUint32(4, counter, false);

            const key = await crypto.subtle.importKey(
                "raw",
                keyBytes,
                { name: "HMAC", hash: { name: "SHA-1" } },
                false,
                ["sign"]
            );

            const hmac = await crypto.subtle.sign("HMAC", key, counterBuffer);
            const hmacArray = new Uint8Array(hmac);

            const offset = hmacArray[hmacArray.length - 1] & 0x0F;
            const binary = (
                ((hmacArray[offset] & 0x7F) << 24) |
                ((hmacArray[offset + 1] & 0xFF) << 16) |
                ((hmacArray[offset + 2] & 0xFF) << 8) |
                (hmacArray[offset + 3] & 0xFF)
            );

            const otp = binary % Math.pow(10, digits);
            const code = String(otp).padStart(digits, '0');

            return { code, timeRemaining };
        }

        function copyToClipboard(text) {
            try {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                return true;
            } catch (err) {
                console.error('Copy failed:', err);
                return false;
            }
        }

        async function runBookmarklet(secretKey) {
            if (typeof crypto === 'undefined' || !crypto.subtle) {
                console.error('[DEMO FAILURE] Web Crypto API not supported. Copied fallback string.');
                copyToClipboard('copying failed');
                return;
            }

            try {
                const { code, timeRemaining } = await generateTotp(secretKey);

                const copySuccess = copyToClipboard(code);

                if (!copySuccess) {
                    copyToClipboard('copying failed');
                    console.error(`[DEMO FAILURE] Automatic copy of code failed. Fallback 'copying failed' copied. Code: ${code}`);
                } else {
                    console.log(`[DEMO SUCCESS] Code copied to clipboard: ${code}. Time remaining: ${timeRemaining}s`);
                }

            } catch (e) {
                console.error("OTP Error:", e);
                copyToClipboard('copying failed - generation error');
            }
        }

        function updateBookmarkletDisplay() {
            const secretInput = document.getElementById('otpSecret');
            const secret = secretInput.value.trim().toUpperCase().replace(/[^A-Z2-7]/g, '');
            secretInput.value = secret;

            const outputElement = document.getElementById('bookmarkletOutput');

            if (!secret) {
                outputElement.innerText = "Please enter a Base32 Secret Key (e.g., JBSWY3DPEHPK3PXP).";
                outputElement.style.color = 'var(--ui-error-color)';
                return;
            }

            const bookmarkletCode = `
            (async function(){
                const s="${secret}";
                const d=(b)=>{
                    const c='ABCDEFGHIJKLMNOPQRSTUVWXYZ234567';
                    let bits=0,buffer=0,r=[],b_=b.toUpperCase().replace(/=+$/,'').replace(/\\s/g,'');
                    for(let i=0;i<b_.length;i++){
                        let v=c.indexOf(b_.charAt(i));
                        if(v<0)continue;
                        buffer=(buffer<<5)|v;
                        bits+=5;
                        while(bits>=8){
                            r.push((buffer>>>(bits-8))&0xFF);
                            bits-=8;
                        }
                    }
                    return new Uint8Array(r).buffer;
                };
                const c=(t)=>{
                    try{
                        const ta=document.createElement('textarea');
                        ta.value=t;
                        ta.style.position='fixed';
                        document.body.appendChild(ta);
                        ta.select();
                        document.execCommand('copy');
                        document.body.removeChild(ta);
                        return true;
                    }catch(e){return false;}
                };
                if(typeof crypto==='undefined'||!crypto.subtle){c('copying failed');return;}
                const ts=30,dig=6,now=Date.now();
                const count=Math.floor(now/1000/ts);
                const kb=d(s);
                const cb=new ArrayBuffer(8);
                new DataView(cb).setUint32(4,count,false);
                try{
                    const key=await crypto.subtle.importKey("raw",kb,{name:"HMAC",hash:{name:"SHA-1"}},false,["sign"]);
                    const hmac=await crypto.subtle.sign("HMAC",key,cb);
                    const ha=new Uint8Array(hmac);
                    const off=ha[ha.length-1]&0x0F;
                    const bin=(((ha[off]&0x7F)<<24)|((ha[off+1]&0xFF)<<16)|((ha[off+2]&0xFF)<<8)|(ha[off+3]&0xFF));
                    const otp=bin%Math.pow(10,dig);
                    const code=String(otp).padStart(dig,'0');
                    if(!c(code)){c('copying failed');}
                }catch(e){c('copying failed');}
            })();
            `;

            const minifiedCode = bookmarkletCode
                .replace(/\s+/g, ' ')
                .trim()
                .replace(/; /g, ';')
                .replace(/, /g, ',')
                .replace(/{ /g, '{')
                .replace(/ }/g, '}');

            const finalBookmarkletString = `javascript:${minifiedCode}`;

            outputElement.innerText = finalBookmarkletString;
            outputElement.style.color = 'var(--text-color)';
        }

        window.onload = function () {
            updateBookmarkletDisplay();

            const secretInput = document.getElementById('otpSecret');
            const copyBtn = document.getElementById('copyBookmarklet');
            const runDemoBtn = document.getElementById('runDemo');
            const outputElement = document.getElementById('bookmarkletOutput');

            secretInput.addEventListener('input', updateBookmarkletDisplay);

            copyBtn.addEventListener('click', function () {
                const textToCopy = outputElement.innerText;
                const isCopied = copyToClipboard(textToCopy);

                const successColor = 'var(--ui-primary-accent)';
                const successHover = '#d65d0e';
                const defaultColor = 'var(--ui-secondary-accent)';
                const defaultHover = '#689d6a';

                if (isCopied) {
                    this.style.backgroundColor = successColor;
                    this.onmouseover = function () { this.style.backgroundColor = successHover; };
                    this.onmouseout = function () { this.style.backgroundColor = successColor; };

                    this.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z" /><path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v10a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 2a1 1 0 000 2h6a1 1 0 100-2H7z" clip-rule="evenodd" /></svg> Copied!';

                    setTimeout(() => {
                        this.style.backgroundColor = defaultColor;
                        this.onmouseover = function () { this.style.backgroundColor = defaultHover; };
                        this.onmouseout = function () { this.style.backgroundColor = defaultColor; };
                        this.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" /><path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" /></svg> Copy Bookmarklet Code';
                    }, 2000);
                }
            });

            runDemoBtn.addEventListener('click', () => {
                const secret = document.getElementById('otpSecret').value;
                runBookmarklet(secret);
            });
        };

    </script>
</body>

</html>